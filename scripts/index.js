const e=document.querySelector(".container"),t=document.querySelector("button"),l=document.querySelector(".winner");function n(){e.innerHTML="",l.classList.add("hidden");const{Engine:t,Render:n,Runner:r,World:o,Bodies:a,Body:i,Events:c}=Matter,d=window.innerWidth,s=window.innerHeight,y=d/14,f=s/18,u=t.create();u.world.gravity.y=0;const{world:h}=u,g=n.create({element:e,engine:u,options:{wireframes:!1,width:d,height:s}});n.run(g),r.run(r.create(),u);const m=[a.rectangle(d/2,0,d,2,{isStatic:!0}),a.rectangle(d/2,s,d,2,{isStatic:!0}),a.rectangle(0,s/2,2,s,{isStatic:!0}),a.rectangle(d,s/2,2,s,{isStatic:!0})];o.add(h,m);const S=Array(18).fill(null).map(()=>Array(14).fill(!1)),w=Array(18).fill(null).map(()=>Array(13).fill(!1)),b=Array(17).fill(null).map(()=>Array(14).fill(!1)),E=Math.floor(18*Math.random()),M=Math.floor(14*Math.random()),p=(e,t)=>{if(S[e][t])return;S[e][t]=!0;const l=(e=>{let t=e.length;for(;t>0;){const l=Math.floor(Math.random()*t);t--;const n=e[t];e[t]=e[l],e[l]=n}return e})([[e-1,t,"up"],[e,t+1,"right"],[e+1,t,"down"],[e,t-1,"left"]]);for(let n of l){const[l,r,o]=n;l<0||l>=18||r<0||r>=14||(S[l][r]||("up"===o?b[e-1][t]=!0:"down"===o?b[e][t]=!0:"left"===o?w[e][t-1]=!0:"right"===o&&(w[e][t]=!0),p(l,r)))}};p(E,M),b.forEach((e,t)=>{e.forEach((e,l)=>{if(e)return;const n=a.rectangle(l*y+y/2,t*f+f,y,3,{label:"wall",isStatic:!0,render:{fillStyle:"red"}});o.add(h,n)})}),w.forEach((e,t)=>{e.forEach((e,l)=>{if(e)return;const n=a.rectangle(l*y+y,t*f+f/2,3,f,{label:"wall",isStatic:!0,render:{fillStyle:"red"}});o.add(h,n)})});const v=a.rectangle(d-y/2,s-f/2,.7*y,.7*f,{isStatic:!0,label:"goal",render:{fillStyle:"green"}});o.add(h,v);const x=Math.min(y,f)/4,A=a.circle(y/2,f/2,x,{label:"ball",render:{fillStyle:"blue"}});o.add(h,A);let k=null;document.onkeydown=({keyCode:e})=>{const{x:t,y:l}=A.velocity;k&&clearTimeout(k),87===e&&l>=-10&&i.setVelocity(A,{x:t,y:l-3}),68===e&&t<=10&&i.setVelocity(A,{x:t+3,y:l}),83===e&&l<=10&&i.setVelocity(A,{x:t,y:l+3}),65===e&&t>=-10&&i.setVelocity(A,{x:t-3,y:l})},document.onkeyup=({keycode:e})=>{const{x:t,y:l}=A.velocity;k=setTimeout(()=>{i.setVelocity(A,{x:0,y:0})},100)},c.on(u,"collisionStart",e=>{e.pairs.forEach(e=>{const t=["ball","goal"];t.includes(e.bodyA.label)&&t.includes(e.bodyB.label)&&(l.classList.remove("hidden"),h.gravity.y=1,h.bodies.forEach(e=>{"wall"===e.label&&i.setStatic(e,!1)}))})})}t.addEventListener("click",n),n();